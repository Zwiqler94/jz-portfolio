name: Version On Merge
concurrency: 
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
'on':
  push:
    branches: ['development']
env:
  commitMsg: ${{ github.event.commits[0].message }}
jobs:
  version-patch:
    strategy:
      matrix: 
       types: ["fix(","perf(","revert(","docs(","style(","chore(","refactor(","test(","build(","ci("]
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        if: contains(env.commitMsg, matrix.types)
        uses: actions/checkout@v3
      - name: Use Node.js 18
        if: contains(env.commitMsg, matrix.types)
        uses: actions/setup-node@v3
        with: 
          version: 18
          cache: 'npm'
      - name: version
        if: contains(env.commitMsg,  matrix.types)
        run: |
             git pull --tags
             git config --local user.name 'github-actions[bot]'
             git config --local user.email 'github-actions[bot]@users.noreply.github.com'
             npm i
             npm version patch
             git push --tags
             git push
  version-minor:
    needs: version-patch
    strategy:
      matrix: 
       types: ["feat"]
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        if: contains(env.commitMsg, matrix.types)
        uses: actions/checkout@v3
      - name: Use Node.js 18
        if: contains(env.commitMsg, matrix.types)
        uses: actions/setup-node@v3
        with: 
          version: 18
          cache: 'npm'
      - name: version
        if: contains(env.commitMsg,  matrix.types)
        run: |
             git pull --tags
             git config --local user.name 'github-actions[bot]'
             git config --local user.email 'github-actions[bot]@users.noreply.github.com'
             npm i
             npm version minor
             git push --tags
             git push
    
  version-major:
    needs: version-minor
    strategy:
      matrix: 
       types: ["BREAKING CHANGE", "!:"]
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        if: contains(env.commitMsg, matrix.types)
        uses: actions/checkout@v3
      - name: Use Node.js 18
        if: contains(env.commitMsg, matrix.types)
        uses: actions/setup-node@v3
        with: 
          version: 18
          cache: 'npm'
      - name: version
        if: contains(env.commitMsg,  matrix.types)
        run: |
             git pull --tags
             git config --local user.name 'github-actions[bot]'
             git config --local user.email 'github-actions[bot]@users.noreply.github.com'
             npm i
             npm version major
             git push --tags
             git push       
        
  
